<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Your RevProject Workspace</title>
    <link rel="preload" href="fonts/Inter-400.ttf" as="font" type="font/ttf" crossorigin />
    <link rel="preload" href="fonts/Inter-500.ttf" as="font" type="font/ttf" crossorigin />
    <link rel="preload" href="fonts/Inter-600.ttf" as="font" type="font/ttf" crossorigin />
    <link rel="preload" href="fonts/Inter-700.ttf" as="font" type="font/ttf" crossorigin />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body class="is-loading">
    <main class="login-layout">
      <section class="card" id="auth-card">
        <header>
          <h1>Register your company</h1>
          <p class="card-subtitle">
            Create a company workspace, invite yourself in as the first operator, and you'll be signed in automatically.
          </p>
        </header>

        <form
          id="register-form"
          method="post"
          action="/auth/register"
          hx-post="/auth/register"
          hx-target="#register-message"
          hx-swap="innerHTML"
          hx-indicator="#register-indicator"
        >
          <label>
            Company name
            <input
              type="text"
              name="companyName"
              class="input-field"
              autocomplete="organization"
              required
              placeholder="Acme Corporation"
            />
          </label>

          <label>
            Email address
            <input
              type="email"
              name="email"
              class="input-field"
              autocomplete="email"
              required
              placeholder="founder@acme.com"
            />
          </label>

          <label>
            Password
            <input
              type="password"
              name="password"
              class="input-field"
              autocomplete="new-password"
              minlength="8"
              required
              placeholder="Create a secure password"
            />
          </label>

          <label>
            Confirm password
            <input
              type="password"
              name="confirmPassword"
              class="input-field"
              autocomplete="new-password"
              minlength="8"
              required
              placeholder="Re-enter your password"
            />
          </label>

          <button type="submit">Create workspace</button>

          <div
            id="register-indicator"
            class="htmx-indicator"
            aria-live="polite"
            aria-hidden="true"
          >
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="9" stroke-opacity="0.2" />
              <path d="M21 12a9 9 0 0 1-9 9" />
            </svg>
            Setting up your workspaceâ€¦
          </div>

          <p id="register-message" class="message" aria-live="polite"></p>
        </form>

        <div class="alt-actions">
          <span>Already have access?</span>
          <a href="/login">Return to login</a>
        </div>
      </section>
    </main>

    <script>
      (function () {
        function removeLoadingClass() {
          document.body.classList.remove('is-loading');
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', removeLoadingClass, {
            once: true,
          });
        } else {
          removeLoadingClass();
        }

        function injectHTMX() {
          if (document.documentElement.dataset.htmxLoaded) return;
          document.documentElement.dataset.htmxLoaded = 'true';
          var script = document.createElement('script');
          script.src = 'https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.min.js';
          script.integrity = 'sha384-ZBXiYtYQ6hJ2Y0ZNoYuI+Nq5MqWBr+chMrS/RkXpNzQCApHEhOt2aY8EJgqwHLkJ';
          script.crossOrigin = 'anonymous';
          script.onload = wireRegistrationHandlers;
          document.head.appendChild(script);
        }

        function wireRegistrationHandlers() {
          document.body.addEventListener('htmx:afterRequest', function (event) {
            if (!(event.target instanceof HTMLFormElement)) return;
            if (event.target.id !== 'register-form') return;

            var messageEl = document.getElementById('register-message');
            if (!messageEl) {
              return;
            }

            messageEl.classList.remove('success');

            var responseText = event.detail.xhr.response || '';
            var displayText = '';

            try {
              var payload = JSON.parse(responseText);
              var key = event.detail.successful ? 'message' : 'error';
              displayText = payload && payload[key] ? payload[key] : '';
            } catch (err) {
              displayText = responseText;
            }

            if (event.detail.successful) {
              messageEl.classList.add('success');
            }

            messageEl.textContent = displayText || (event.detail.successful ? 'Registration complete!' : 'Registration failed. Please try again.');
          });
        }

        if ('requestIdleCallback' in window) {
          requestIdleCallback(injectHTMX);
        } else {
          window.addEventListener('load', injectHTMX, { once: true });
        }
      })();
    </script>
  </body>
</html>
